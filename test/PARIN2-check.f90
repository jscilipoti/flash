program check
    use do_tests
    ! Units available to open a file:
    use openunits, only: intrcn32_unit, qPar150_unit, rPar150_unit
    use iso_fortran_env!, only: int16, real32, real64 
    
    implicit none
    integer(kind=int16) :: i, j
    
    
    ! Here the interaction parameters are dim 100 because
    ! there is a maximum of 10 different functional groups in total
    real(kind=real64),dimension(100,100) :: A = 0.D0
    real(kind=real64),dimension(100,100) :: intrcn32_data = 0.D0
    ! Arrays with re r and q parameters. Dim=150 because there are 150 values.
    real(kind=real32), dimension(150) :: RR, QQ, rPar150_data, qPar150_data                                            
    
    ! Original code method for filling up "A" matrix by unsing "An" arrays.
    real(kind=real32), dimension(32) :: &
        &A1, A2, A3, A4, A5, A6, A7, A8,&
        &A9, A10, A11, A12, A13, A14, A15, A16,&
        &A17, A18, A19, A20, A21, A22, A23, A24,&
        &A25, A26, A27, A28, A29, A30, A31, A32
    
    DATA RR/&
    &.9011, .6744, .4469, .2195, 1.3454,&
    &1.1167, .8886, 1.1173, .5313, .3652,&
    &1.2663, 1.0396, .8121, 1., 3.2499,&
    &3.2491, .92, .8952, 1.6724, 1.4457,&
    &.998, 3.168, 1.3013, 1.528, 1.9031,&
    &1.6764, 1.145, .9183, .6908, .9183,&
    &1.4654,1.238, 1.006, 2.2564, 2.0606,&
    &1.8016, 2.87, 2.6401, 3.39, 1.1562,&
    &1.870132, 1.6434, 1.06, 2.0086, 1.7818,&
    &1.5544, 1.4199, 2.4088, 4.0013, 2.9993,&
    &2.83, 2.667, 3.3092, 2.4317, 3.0856,&
    &4.0358, 2.8266,0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0/ 
                              
    DATA QQ/&
    &.848, .54, .228, 0., 1.176,&
    &.867, .676, .988, .4, .12,&
    &.968, .66, .348, 1.2, 3.128,&
    &3.124, 1.4, .68, 1.488, 1.18,&
    &.948, 2.484, 1.224, 1.532, 1.728,&
    &1.42, 1.088, .78, .468, 1.1,&
    &1.264, .952, .724, 1.988, 1.684,&
    &1.448, 2.41, 2.184, 2.91, .844,&
    &1.724, 1.416, .816, 1.868, 1.56,&
    &1.248, 1.104, 2.248, 3.568, 2.113,&
    &1.833, 1.553, 2.86, 2.192, 2.736,&
    &3.2, 2.472, 0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0,&
    &0.0, 0.0, 0.0, 0.0, 0.0/

    DATA A1/&
    &0., 292.3, 156.5, 104.4, 328.2, -136.7, -131.9, 342.4,&
    &-159.8, 66.56, 146.1, 14.78, 1744., -320.1, 1571., 73.8,&
    &27.9, 21.23, 89.97, -59.06, 29.08, 175.8, 94.34, 193.6,&
    &108.5, 81.49, -128.8, 147.3, -11.91, 14.91, 67.84, 36.42/

    DATA A2/&
    &74.54, 0., -94.78, -269.7, 470.7, -135.7, -135.7, 220.6,&
    &1., 306.1, 517., 1., -48.52, 485.6, 76.44, -24.36,&
    &-52.71, -185.1, -293.7, 1., 34.78, 1., 375.4,&
    &5*1., 176.7, 132.1, 42.73, 60.82/

    DATA A3/&
    &-114.8, 340.7, 0., -146.8, -9.21, -223., -252., 372.8,&
    &-473.2, -78.31, -75.3, -10.44, 75.49, 114.8, 52.13, 4.68,&
    &1., 288.5, -4.7, 777.8, 56.41, -218.9, 113.6, 7.18,&
    &247.3, -50.71, -255.3, 1., -80.48, -17.78, 59.16, 29.77/

    DATA A4/&
    &-115.7, 4102., 167., 0., 1.27, -162.6, -273.6, 203.7,&
    &-470.4, -73.87, 223.2, -184.9, 147.3, -170., 65.69,122.9,&
    &1., 33.61, 134.7, -47.13, -53.29, -15.41,-97.05, -127.1,&
    &453.4, -30.28, -124.6, 3*1., 26.59, 55.97/

    DATA A5/&
    &644.6, 724.4, 703.9, 4000., 0., -281.1, -268.8, -122.4,&
    &-63.15, 216., -431.3, 444.7, 118.4, 180.6, 137.1, 455.1,&
    &669.2, 418.4, 713.5, 1989., 2011., 529., 483.8, 332.6,&
    &-289.3, -99.56, -319.2, 837.9, 4*1./

    DATA A6/329.6, 1731., 511.5, 136.6, 937.3, 2*0., 247.,&
    &-547., 401.7, 643.4, -94.64, 728.7, -76.64, -218.1, 351.5,&
    &-186.1, -465.7, -260.3, 3*1., 264.7,&
    &9*1./

    DATA A7/&
    &310.7, 1731., 577.3, 906.8, 991.3, 2*0., 104.9,&
    &-547.2, -127.6, 231.4, 732.3, 349.1, -152.8, -218.1, 351.5,&
    &-401.6, -465.7, 512.2, 3*1., 264.7,&
    &9*1./

    DATA A8/&
    &1300., 896., 859.4, 5695., 28.73, -61.29, 5.89, 0.,&
    &-595.9, 634.8, 623.7, 211.6, 652.3, 385.9, 212.8, 770.,&
    &740.4, 793.2, 1205., 390.7, 63.48, -239.8, 13.32, 439.9,&
    &-424.3, 1., 203., 1153., -311., -262.6, 1.11, 1./

    DATA A9/&
    &2255., 1., 1649., 292.6, -195.5, -153.2, -153.2, 344.5,&
    &0., -568., 3*1., -337.3, 4*1., 1616., 2*1., -860.3, 1., -230.4,&
    &523., 1., -222.7, 5*1./

    DATA A10/&
    &472.6, 343.7, 593.7, 916.7, 67.07, -47.41, 353.8, -171.8,&
    &-825.7, 0., 128., 48.93, -101.3, 58.84, 52.38, 483.9,&
    &550.6, 342.2, 550., 190.5, -349.2, 857.7, 377., 211.6,&
    &82.77, 2*1., 417.4, 4*1./         

    DATA A11/&
    &158.1, -214.7, 362.3, 1218., 1409., -344.1, -338.6, -349.9,&
    &1., -37.36, 0., -311.6, 1051., 1090., 1., -47.51,&
    &16*1./

    DATA A12/&
    &383., 1., 31.14, 715.6, -140.3, 299.3, -241.8, 66.95,&
    &1., 120.3, 1724., 0., -115.7, -46.13, 2*1.,&
    &808.8, 203.1, 70.14, 5*1.,&
    &-75.23, 1., -201.9, 123.2, 1., -281.9, 2*1./

    DATA A13/&
    &139.4, 1647., 461.8, 339.1, -104., 244.4, -57.98, -465.7,&
    &1., 1247., .75, 1919., 0., 1417., 1402., 337.1,&
    &437.7, 370.4, 438.1, 1349., 1., 681.4, 152.4, 1.,&
    &-1707., 2*1., 639.7, 4*1./

    DATA A14/&
    &972.4, -577.5, 6., 5688., 195.6, 19.57, 487.1, -6.32,&
    &-898.3, 258.70, -245.8, 57.7, -117.6, 0., 461.3, 1.,&
    &-132.9, 176.5, 129.5, -246.3, 2.41, 3*1.,&
    &29.86, 7*1./

    DATA A15/&
    &662.1, 289.3, 32.14, 213.1, 262.5, 1970., 1970., 64.42,&
    &1., 5.202, 2*1., -96.62, -235.7, 0., 225.4,&
    &-197.7, -20.93, 113.9, 3*1., -94.49,&
    &9*1./

    DATA A16/&
    &42.14, 99.61, -18.81, -114.1, 62.05, -166.4, -166.4, 315.9,&
    &1., 1000., 751.8, 1., 19.77, 1., 301.1, 0.,&
    &-21.35, -157.1, 11.8, 13*1./

    DATA A17/&
    &-243.9, 337.1, 2*1., 272.2, 128.6, 507.8, 370.7,&
    &1., -301., 1., -347.9, 1670., 108.9, 137.8, 110.5,&
    &0., 1., 17.97, 13*1./

    DATA A18/&
    &7.5, 4583., -231.9, -12.14, -61.57, 2*1544., 356.8,&
    &1., 12.01, 1., -249.3, 48.15, -209.7, -154.3, 249.2,&
    &1., 0., 51.9, 1., -15.62, -216.3, 4*1., -114.7, 5*1./

    DATA A19/&
    &-5.55, 5831., 3000., -141.3, -41.75, 224.6, -207., 502.9,&
    &4894., -10.88, 1., 61.59, 43.83, 54.57, 47.67, 62.42,&
    &56.33, -30.1, 0., -255.4, -54.86, 8455., -34.68, 514.6,&
    &8*1./

    DATA A20/&
    &924.8, 1., -878.1, -107.3, -597.1, 2*1., -97.27,&
    &1., 902.6, 2*1., 874.3, 629., 4*1., 475.8, 0., -465.2, 1., 794.4, 1.,&
    &-241.7, 1., -906.5, 5*1./

    DATA A21/&
    &696.8, 405.9, 29.13, 1208., -189.3, 2*1., 198.3,&
    &1., 430.6, 3*1., -149.2, 3*1.,&
    &70.04, 492., 346.2, 0., 5*1., -169.7, 5*1./

    DATA A22/&
    &902.2, 1., 1.64, 689.6, -348.2, 1., 1., -109.8,&
    &-851.6, 1010., 2*1., 942.2, 4*1.,&
    &-75.5, 1302., 2*1., 0., 1., 175.8, 164.4,&
    &1., -944.9, 5*1./

    DATA A23/&
    &556.7, 425.7, -1.77, 3629., -30.7, 150.8, 150.8, 1538.6,&
    &1., 400., 2*1., 446.3, 1., 95.18,&
    &3*1., 490.9, -154.5, 2*1., 0.,&
    &1., 481.3, 7*1./

    DATA A24/&
    &575.7, 1., -11.19, -175.6, -159., 2*1., 32.92,&
    &-16.13, -328.6, 8*1., 534.7, 2*1., 179.9, 1., 0.,&
    &-246., 7*1./

    DATA A25/&
    &527.5, 1., 358.9, 337.7, 536.6, 2*1., -269.2,&
    &-538.6, 211.6, 1., -278.2, 572.7, 343.1, 5*1., 124.8, 1., 125.3, 139.8,&
    &963., 0., 7*1./

    DATA A26/&
    &269.2, 1., 363.5, 1023., 53.37, 20*1., 0., 6*1./

    DATA A27/&
    &-300., 1., -578.2, -390.7, 183.3, 2*1., -873.6,&
    &-637.3, 2*1., -208.4, 5*1.,&
    &18.98, 1., -387.7, 134.3, 924.5, 4*1.,&
    &0., 5*1./

    DATA A28/&
    &-63.6, 3*1., -44.44, 2*1., 1429.,&
    &1., 148., 1., -13.91, -2.16, 14*1., 0., 4*1./

    DATA A29/&
    &928.3, 500.7, 364.2, 4*1., -364.2,&
    &20*1., 0., 3*1./

    DATA A30/&
    &331., 115.4, -58.1, 4*1., -117.4,&
    &3*1., 173.8, 17*1., 0., 2*1./

    DATA A31/&
    &561.4, 784.4, 21.97, 238., 3*1., 18.41,&
    &22*1., 0., 1./

    DATA A32/&
    &956.5, 265.4, 84.16, 132.2, 27*1., 0./
    
    print *,""
    print *, test_run//"PARIN2-Check"
    
    if (.true.) then
        if (pause_test) pause
        ! Original Loop to fill up A matrix
        do i = 1, 32                                                       
            A(i, 1) = A1(i)                                                      
            A(i, 2) = A2(i)                                                      
            A(i, 3) = A3(i)                                                      
            A(i, 4) = A4(i)                                                      
            A(i, 5) = A5(i)                                                      
            A(i, 6) = A6(i)                                                      
            A(i, 7) = A7(i)                                                      
            A(i, 8) = A8(i)                                                      
            A(i, 9) = A9(i)                                                      
            A(i, 10) = A10(i)                                                    
            A(i, 11) = A11(i)                                                    
            A(i, 12) = A12(i)                                                    
            A(i, 13) = A13(i)                                                    
            A(i, 14) = A14(i)                                                    
            A(i, 15) = A15(i)                                                    
            A(i, 16) = A16(i)                                                    
            A(i, 17) = A17(i)                                                    
            A(i, 18) = A18(i)                                                    
            A(i, 19) = A19(i)                                                    
            A(i, 20) = A20(i)                                                    
            A(i, 21) = A21(i)                                                    
            A(i, 22) = A22(i)                                                    
            A(i, 23) = A23(i)                                                    
            A(i, 24) = A24(i)                                                    
            A(i, 25) = A25(i)                                                    
            A(i, 26) = A26(i)                                                    
            A(i, 27) = A27(i)                                                    
            A(i, 28) = A28(i)                                                    
            A(i, 29) = A29(i)                                                    
            A(i, 30) = A30(i)                                                    
            A(i, 31) = A31(i)                                                    
            A(i, 32) = A32(i)
        end do
        ! New method to fill up intrcn32_data (new A matrix)
        open(newunit=intrcn32_unit, file="src/database/intrcn32.mds",&
            &status='old', action='read', form="formatted")
        read(intrcn32_unit, *) intrcn32_data(:32,:32)
        close(intrcn32_unit)
        ! New method to fill up rPar150_data (new RR matrix)
        open(newunit=rPar150_unit, file="src/database/rPar150.mds",&
            &status='old', action='read', form="formatted")
        read(rPar150_unit, *) rPar150_data(:)
        close(rPar150_unit)
        ! New method to fill up qPar150_data (new QQ matrix)
        open(newunit=qPar150_unit, file="src/database/qPar150.mds",&
            &status='old', action='read', form="formatted")
        read(qPar150_unit, *) qPar150_data(:)
        close(qPar150_unit)

        ! Verify if everything went ok

        !if ("string" /= "string")& 
        !     &ERROR STOP ""

        ! Check if intrcn32_data and A are different)
        do i = 1, 32
            do j = 1, 32
                if (abs(A(i,j) - intrcn32_data(i,j)) > 1E-4) then
                    print *, "HERE:"
                    print *, "intrcn32_data(",i,",",j,")"
                    print *, "intrcn32_data value is: ", intrcn32_data(i,j)
                    print *, "original value was: ", A(i,j)
                    ERROR STOP "Look NEO, an error in the Matrix!.& 
                    &New matrix code for parameters gives different values& 
                    &and differs from the original."
                end if
            end do
        end do
        ! Check if rPar150_data and RR are different)
        !print '(150F5.2)', RR-rPar150_data
        do i = 1, 150
            if (abs(RR(i) - rPar150_data(i)) > 1E-4) then
                print *, "HERE:"
                print *, "rPar150_data(",i,")"
                print *, "rPar150_data value is: ", rPar150_data(i)
                print *, "original value was: ", RR(i)
                ERROR STOP "Look NEO, an error in the Matrix!.& 
                &New matrix code for R parameters gives different values& 
                &and differs from the original."
            end if
        end do
        ! Check if qPar150_data and QQ are different)    
        !print '(150F5.2)', QQ-QPar150_data
        do i = 1, 150
            if (abs(QQ(i) - qPar150_data(i)) > 1E-4) then
                print *, "HERE:"
                print *, "qPar150_data(",i,")"
                print *, "qPar150_data value is: ", qPar150_data(i)
                print *, "original value was: ", QQ(i)
                ERROR STOP "Look NEO, an error in the Matrix!.& 
                &New matrix code for Q parameters gives different values& 
                &and differs from the original."
            end if
        end do
        
        print *, test_ok

    else 
        print *, test_disabled
    endif

!print *, "Put some tests in here!"

end program check
